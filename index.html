<!DOCTYPE html>
<html lang="ar" dir="ltr">
<head>
  <meta charset="utf-8"/>
  <title>Rain Game ‚Äî Withdraw USDT</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"/>

  <!-- SDK libtl.com -->
  <script src='//libtl.com/sdk.js' data-zone='10245709' data-sdk='show_10245709'></script>

  <style>
    :root{
      --bg-900: #050814;
      --bg-800: #071020;
      --glass-01: rgba(255,255,255,.018);
      --glass-02: rgba(255,255,255,.012);
      --border-weak: rgba(255,255,255,.04);
      --muted: #96a3b3;
      --text: #eaf6f2;
      --accent: #00d1a7;
      --accent-2: #00bcd4;
      --danger: #ff6b64;
      --radius: 14px;
      --pill-radius: 28px;
      --shadow-soft: 0 8px 28px rgba(3,7,18,.55);
      --shadow-lg: 0 22px 64px rgba(3,7,18,.72);
      --glass-blur: 8px;
      --easing: cubic-bezier(.16,.9,.34,1);
      --hud-pad: 10px 14px;
      --max-panel: 640px;
      --focus-ring: 0 0 0 4px rgba(0,209,167,.12);
      --tap-scale: .985;
    }

    *,*::before,*::after{box-sizing:border-box}
    html,body{Height:100%;margin:0;background:radial-gradient(900px 420px at 14% 10%, rgba(0,209,167,.02), transparent 6%), linear-gradient(135deg,var(--bg-900),var(--bg-800));color:var(--text);font-family:Inter,"Segoe UI",Roboto,"Helvetica Neue",Arial,system-ui,-apple-system;font-size:15px;line-height:1.28;-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}
    body{width:100vw;height:100vh;position:fixed;top:0;left:0;user-select:none;overflow:hidden;-webkit-user-select:none;-ms-touch-action:manipulation;touch-action:manipulation}

    /* HUD */
    #timerWrap,#scoreWrap{position:absolute;top:12px;display:flex;align-items:center;gap:10px;padding:var(--hud-pad);border-radius:var(--pill-radius);background:linear-gradient(180deg,var(--glass-01),var(--glass-02));border:1px solid var(--border-weak);box-shadow:var(--shadow-soft),0 1px 0 rgba(255,255,255,.02) inset;backdrop-filter:blur(var(--glass-blur)) saturate(120%);-webkit-backdrop-filter:blur(var(--glass-blur)) saturate(120%);transition:transform .18s var(--easing),box-shadow .18s var(--easing),opacity .18s linear;z-index:140;font-weight:700;color:var(--muted);min-height:48px;font-size:14px;-webkit-tap-highlight-color:transparent}
    #timerWrap{left:12px}#scoreWrap{right:12px}
    #timerWrap span,#scoreWrap span{display:inline-block;padding:8px 12px;border-radius:12px;background:linear-gradient(180deg,rgba(0,0,0,.16),rgba(255,255,255,.01));color:var(--accent);font-weight:900;font-variant-numeric:tabular-nums;box-shadow:0 6px 20px rgba(0,0,0,.48),0 1px 0 rgba(255,255,255,.02) inset;letter-spacing:.4px;min-width:44px;text-align:center}
    #timerWrap:hover,#scoreWrap:hover{transform:translateY(-6px);box-shadow:0 18px 42px rgba(0,0,0,.6)}

    #overlay{position:fixed;inset:0;background:linear-gradient(180deg,rgba(2,6,12,.56),rgba(2,6,12,.72));display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .36s var(--easing),transform .36s var(--easing);z-index:120}
    #overlay.show{opacity:1;pointer-events:auto}
    .card-end{width:min(92%,520px);padding:26px 30px;border-radius:18px;background:linear-gradient(180deg,rgba(255,255,255,.014),rgba(255,255,255,.006));border:1px solid rgba(255,255,255,.035);box-shadow:var(--shadow-lg),inset 0 1px 0 rgba(255,255,255,.02);color:var(--text);text-align:center;transform:translateY(10px) scale(.995);transition:transform .28s var(--easing),opacity .28s var(--easing);will-change:transform,opacity}
    .card-end h2{margin:0 0 8px;font-size:13px;color:var(--muted);letter-spacing:2px;font-weight:700;text-transform:uppercase;opacity:.95}
    .card-end p{margin:0 0 16px;font-size:46px;font-weight:900;color:var(--text);letter-spacing:.6px;text-shadow:0 10px 34px rgba(0,0,0,.65);line-height:1}
    .card-end .btn{min-width:140px;height:44px;font-size:13px}

    #restartBtn,
    #withdrawBtnOverlay {
      background:linear-gradient(135deg,var(--accent),var(--accent-2));
      color:#021617;
      border:none;
      box-shadow:0 10px 36px rgba(0,209,167,.12);
      padding:10px 18px;
      border-radius:12px;
      font-weight:800;
      font-size:13px;
      transition:transform .18s var(--easing),box-shadow .18s var(--easing);
      min-width:140px;
      -webkit-tap-highlight-color:transparent;
    }
    #restartBtn:hover,
    #withdrawBtnOverlay:hover {
      transform:translateY(-3px);
      box-shadow:0 20px 60px rgba(0,209,167,.14);
    }
    #restartBtn { margin-right:6px }

    #withdrawPanel{position:fixed;inset:0;z-index:130;display:flex;align-items:center;justify-content:center;pointer-events:none;opacity:0;transition:opacity .28s var(--easing);background:linear-gradient(180deg,rgba(2,6,23,.84),rgba(2,6,23,.9))}
    #withdrawPanel.show{opacity:1;pointer-events:auto}
    .panel{width:100%;max-width:var(--max-panel);border-radius:18px;padding:22px;background:linear-gradient(180deg,rgba(255,255,255,.014),rgba(255,255,255,.004));border:1px solid rgba(255,255,255,.035);box-shadow:0 30px 80px rgba(2,8,18,.72);backdrop-filter:blur(6px) saturate(120%);-webkit-backdrop-filter:blur(6px) saturate(120%);color:var(--text);transform:translateY(6px);transition:transform .28s var(--easing),opacity .28s var(--easing);position:relative;will-change:transform,opacity}
    .panel::after{content:"BNB Smart Chain ¬∑ USDT";position:absolute;top:12px;right:16px;font-size:12px;color:var(--muted);background:transparent;padding:4px 8px;border-radius:10px;font-weight:700;letter-spacing:.3px;opacity:.95;pointer-events:none}
    .panel h1{margin:0 0 10px;font-size:18px;color:var(--accent);font-weight:800;letter-spacing:.4px}
    .balance{display:flex;align-items:center;justify-content:space-between;gap:12px;margin:12px 0 18px;padding:18px;border-radius:14px;background:linear-gradient(180deg,rgba(0,0,0,.22),rgba(255,255,255,.005));border:1px solid rgba(255,255,255,.03);position:relative;overflow:visible;box-shadow:0 10px 30px rgba(2,8,18,.45)}
    .balance::before{content:"Available Balance";position:absolute;top:-12px;left:16px;background:transparent;color:var(--muted);font-size:12px;padding:2px 8px;border-radius:10px;font-weight:700;letter-spacing:.4px;transform:translateY(-2px)}
    .bal-num{font-size:34px;font-weight:900;color:var(--text);text-shadow:0 10px 36px rgba(0,0,0,.6);font-variant-numeric:tabular-nums}
    .balance::after{content:"";position:absolute;left:18px;right:18px;bottom:8px;height:4px;border-radius:6px;background:linear-gradient(90deg,rgba(0,209,167,.20),rgba(0,188,212,.12));filter:blur(6px);opacity:.98}
    label{display:block;font-size:13px;color:var(--muted);margin:12px 0 6px;font-weight:700}
    input[type="text"],input[type="number"]{width:100%;padding:14px;border-radius:12px;border:1px solid rgba(255,255,255,.06);background:linear-gradient(180deg,rgba(255,255,255,.006),rgba(255,255,255,.002));color:var(--text);font-size:15px;outline:none;transition:box-shadow .16s var(--easing),border-color .16s var(--easing),transform .12s var(--easing);-webkit-appearance:none;-moz-appearance:none}
    input::placeholder{color:rgba(234,246,242,.42)}
    input:focus{box-shadow:var(--focus-ring);border-color:rgba(0,209,167,.24);transform:translateY(-1px)}
    label[for="amount"]{position:relative}
    label[for="amount"]::after{content:"Minimum withdrawal: 2 USDT";display:block;margin-top:6px;font-size:12px;color:var(--muted);font-weight:600;opacity:.95}
    .row{display:flex;flex-direction:column;gap:10px;margin-top:14px}
    @media(min-width:720px){.row{flex-direction:row;justify-content:flex-start}}
    .btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 16px;border-radius:12px;border:none;cursor:pointer;font-weight:800;font-size:14px;color:#021617;background:linear-gradient(135deg,var(--accent),var(--accent-2));box-shadow:0 12px 36px rgba(0,209,167,.10);transition:transform .16s var(--easing),box-shadow .18s var(--easing),opacity .12s linear;will-change:transform,box-shadow;min-height:48px;position:relative;overflow:hidden}
    .btn:hover{transform:translateY(-3px);box-shadow:0 28px 64px rgba(0,209,167,.12)}
    .btn:active{transform:translateY(0) scale(var(--tap-scale));box-shadow:0 8px 22px rgba(0,0,0,.36)}
    .btn.ghost{background:transparent;color:var(--muted);border:1px solid rgba(255,255,255,.04);box-shadow:none}
    .btn.ghost:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(2,8,18,.45)}
    #withdrawDoBtn{width:100%}
    #backToGameBtn{width:100%}
    @media(min-width:720px){#withdrawDoBtn{width:auto;min-width:240px;flex:0 1 60%}#backToGameBtn{width:auto;min-width:140px;flex:0 1 auto}}
    .btn[disabled]{opacity:.48;cursor:not-allowed;transform:none;box-shadow:none}
    .btn:focus-visible{outline:none;box-shadow:var(--focus-ring)}
    .helper-btn{display:inline-flex;align-items:center;justify-content:center;padding:8px 10px;border-radius:10px;border:1px solid rgba(255,255,255,.04);background:linear-gradient(180deg,rgba(255,255,255,.006),rgba(255,255,255,.002));color:var(--muted);font-weight:700;font-size:13px;cursor:pointer;min-width:64px}
    .helper-btn:active{transform:scale(.99)}
    .amount-helpers{display:flex;gap:8px;margin-top:8px}

    /* notify */
    #notify{position:fixed;top:18px;left:50%;transform:translateX(-50%) translateY(-8px);background:var(--danger);color:#fff;padding:10px 18px;border-radius:12px;font-size:14px;z-index:150;opacity:0;pointer-events:none;transition:transform .22s ease-out,opacity .22s ease-out;box-shadow:0 12px 36px rgba(0,0,0,.6);display:inline-block}
    #notify.show{opacity:1;pointer-events:auto;transform:translateX(-50%) translateY(0)}

    .pop-emoji{position:absolute;font-size:26px;line-height:1;transform:translateZ(0) scale(.6);animation:emojiPop 220ms ease-out forwards;pointer-events:none;will-change:transform,opacity;color:inherit;text-shadow:none;filter:none}
    @keyframes emojiPop{0%{transform:translateZ(0) translateY(0) scale(.6);opacity:1}60%{transform:translateZ(0) translateY(-8px) scale(1.05);opacity:.9}100%{transform:translateZ(0) translateY(-22px) scale(1.3);opacity:0}}

    .drop{position:absolute;top:-150px;width:90px;height:90px;pointer-events:auto;cursor:pointer;animation:rainDrop 1.6s linear forwards;will-change:transform;filter:drop-shadow(0 4px 10px rgba(0,0,0,.35));border-radius:12px;transition:transform .12s var(--easing),filter .12s var(--easing);-webkit-tap-highlight-color:transparent;touch-action:manipulation}
    .drop:focus{outline:none;box-shadow:var(--focus-ring)}
    @keyframes rainDrop {
      0%   { transform:translateY(-30px) }
      100% { transform:translateY(calc(100vh + 180px)) }
    }
    .drop:hover{transform:scale(1.04)}
    .drop:active{transform:scale(.98);filter:drop-shadow(0 6px 14px rgba(0,0,0,.5))}

    /* ====== ŸÉÿ±ÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ (Glass Card) ====== */
    .ads-card{
      margin:14px 0 18px;
      padding:14px;
      border-radius:14px;
      background:linear-gradient(180deg,var(--glass-01),var(--glass-02));
      border:1px solid var(--border-weak);
      box-shadow:var(--shadow-soft), inset 0 1px 0 rgba(255,255,255,.02);
      backdrop-filter:blur(var(--glass-blur)) saturate(120%);
      -webkit-backdrop-filter:blur(var(--glass-blur)) saturate(120%);
      color:var(--text);
    }
    .ads-card-header{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;font-size:13px;font-weight:700;color:var(--muted);letter-spacing:.4px
    }
    .ads-counter{font-weight:900;color:var(--accent);font-size:15px}
    .progress-bar{
      width:100%;height:10px;border-radius:8px;
      background:linear-gradient(180deg,rgba(0,0,0,.2),rgba(255,255,255,.01));
      overflow:hidden;box-shadow:0 2px 8px rgba(0,0,0,.4), inset 0 1px 0 rgba(255,255,255,.02);
      position:relative;
    }
    .progress-bar.stripes::after{
      content:"";
      position:absolute;inset:0;background-image:linear-gradient(45deg, rgba(255,255,255,.03) 25%, rgba(0,0,0,0) 25%, rgba(0,0,0,0) 50%, rgba(255,255,255,.03) 50%, rgba(255,255,255,.03) 75%, rgba(0,0,0,0) 75%, rgba(0,0,0,0));
      background-size:24px 24px;opacity:.12;pointer-events:none;
    }
    .progress-fill{
      height:100%;border-radius:inherit;
      background:linear-gradient(90deg,var(--accent),var(--accent-2));
      box-shadow:0 0 12px rgba(0,209,167,.18);
      transition:width .35s var(--easing),box-shadow .25s linear;
      will-change:width;
    }
    .progress-fill.pulse{box-shadow:0 0 30px rgba(0,209,167,.28),0 0 60px rgba(0,188,212,.14);animation:progressPulse 1.2s ease-in-out 2}
    @keyframes progressPulse{0%{transform:scaleX(1)}50%{transform:scaleX(1.02)}100%{transform:scaleX(1)}}

    .watch-ad-btn{
      margin-top:10px;width:100%;font-size:13px;min-height:44px;
    }

    .ads-meta{display:flex;justify-content:space-between;align-items:center;margin-top:8px;font-size:12px;color:var(--muted)}
    .ads-remaining{font-weight:700;color:var(--muted);font-size:13px}

    :focus{outline:none;box-shadow:0 12px 40px rgba(0,209,167,.10)}
    @media(max-width:420px){.card-end p{font-size:36px}.panel{padding:18px;border-radius:16px}.bal-num{font-size:28px}#timerWrap,#scoreWrap{top:10px;padding:8px 12px;min-height:44px}#timerWrap span,#scoreWrap span{padding:6px 10px;min-width:40px}}
    @media(max-width:480px){.drop{width:110px;height:110px}.btn{min-height:54px;padding:14px 18px}}
  </style>
</head>
<body>
  <!-- HUD -->
  <div id="timerWrap" role="status" aria-live="polite">Time <span id="timer">30</span></div>
  <div id="scoreWrap" role="status" aria-live="polite">USDT <span id="usdtHud">0.0000</span></div>

  <!-- Game Over Overlay -->
  <div id="overlay" aria-hidden="true">
    <div class="card-end" role="dialog" aria-modal="true" aria-labelledby="endTitle">
      <h2 id="endTitle">Game Over</h2>
      <p id="usdtText">0.0000</p>
      <div style="display:flex;justify-content:center;margin-top:8px">
        <button id="restartBtn" class="btn" aria-label="Restart game">RESTART</button>
        <button id="withdrawBtnOverlay" class="btn" aria-label="Open withdraw panel">Withdraw</button>
      </div>
    </div>
  </div>

  <!-- Withdraw Panel -->
  <div id="withdrawPanel" aria-hidden="true">
    <div class="panel" role="dialog" aria-modal="true" aria-labelledby="withdrawTitle">
      <h1 id="withdrawTitle">Withdraw USDT</h1>
      <div class="balance" aria-live="polite" aria-atomic="true" role="status">
        <div class="bal-num" id="balance">0.0000</div>
        <div style="text-align:right;color:var(--muted);font-weight:700;font-size:13px">Confirmed locally</div>
      </div>

      <!-- ====== ŸÉÿ±ÿ™ ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™ (Glass) ====== -->
      <div class="ads-card" aria-label="Ads progress">
        <div class="ads-card-header">
          <span>Ad Progress</span>
          <span class="ads-counter" aria-hidden="true"><span id="adsCurrent">0</span> / 1000</span>
        </div>
        <div class="progress-bar stripes" aria-hidden="true">
          <div class="progress-fill" id="adsProgress" style="width:0%"></div>
        </div>
        <div class="ads-meta">
          <div class="ads-remaining" id="adsRemaining" aria-live="polite">Remaining: 1000</div>
          <div style="color:var(--muted);font-size:12px"><span id="groupProgress" aria-live="polite">Group: 0/3</span></div>
        </div>
        <button id="watchAdBtn" class="btn watch-ad-btn" aria-label="Watch rewarded ad">Watch Ad</button>
      </div>

      <label for="bnbAddress">BNB Address</label>
      <input id="bnbAddress" type="text" placeholder="0xAbC123... or bnb1xyz..." autocomplete="off" inputmode="text" aria-label="BNB address"/>
      <label for="amount">Amount (USDT)</label>
      <input id="amount" type="number" step="0.0001" min="0" placeholder="Enter amount" inputmode="decimal" aria-label="Withdrawal amount"/>
      <div class="amount-helpers" aria-hidden="false" style="margin-bottom:4px">
        <button id="useMaxBtn" class="helper-btn" type="button" aria-label="Use maximum available balance">Use Max</button>
        <button id="add2Btn" class="helper-btn" type="button" aria-label="Add 2 USDT to amount">+2</button>
        <button id="add5Btn" class="helper-btn" type="button" aria-label="Add 5 USDT to amount">+5</button>
      </div>

      <div class="row">
        <button id="withdrawDoBtn" class="btn" aria-label="Submit withdrawal request">Withdraw Request</button>
        <button id="backToGameBtn" class="btn ghost" aria-label="Back to game">Back</button>
      </div>
    </div>
  </div>

  <!-- Toast Notifications -->
  <div id="notify" role="status" aria-live="polite"></div>

  <script>
    (function(){
      const imgURL='https://files.catbox.moe/d30psp.png';
      const emojis=['üí•','üéâ','‚ú®','üî•','‚ö°','üí´','‚≠ê','üåü'];
      const MIN_WITHDRAW = 2.00;
      const REQUIRED_ADS = 1000;
      const GROUP_SIZE = 3; // new: require watching 3 ads sequentially before incrementing adsWatched by 1

      let usdt = parseFloat(localStorage.getItem('usdt')||'0') || 0;
      let gameActive = true;
      let timeLeft = 30;
      let timerEl, usdtHud, overlay, usdtText;
      let spawnInterval, countDown;

      const withdrawPanel = document.getElementById('withdrawPanel');
      const balanceEl = document.getElementById('balance');
      const addrEl = document.getElementById('bnbAddress');
      const amtEl = document.getElementById('amount');
      const withdrawDoBtn = document.getElementById('withdrawDoBtn');
      const backToGameBtn = document.getElementById('backToGameBtn');
      const notifyEl = document.getElementById('notify');

      // ====== Helper Buttons ======
      const useMaxBtn = document.getElementById('useMaxBtn');
      const add2Btn = document.getElementById('add2Btn');
      const add5Btn = document.getElementById('add5Btn');

      // ====== Ad System Elements ======
      const adsCurrentEl = document.getElementById('adsCurrent');
      const adsProgressEl = document.getElementById('adsProgress');
      const watchAdBtn = document.getElementById('watchAdBtn');
      const adsRemainingEl = document.getElementById('adsRemaining');
      const groupProgressEl = document.getElementById('groupProgress');

      // ====== Ad Counter Logic ======
      let adsWatched = parseInt(localStorage.getItem('adsWatched')||'0',10);
      function saveAds(){ localStorage.setItem('adsWatched', adsWatched); }
      function updateAdUI(){
        adsCurrentEl.textContent = adsWatched;
        const pct = Math.min(adsWatched / REQUIRED_ADS, 1) * 100;
        adsProgressEl.style.width = pct + '%';
        withdrawDoBtn.disabled = adsWatched < REQUIRED_ADS;
        const remaining = Math.max(REQUIRED_ADS - adsWatched, 0);
        adsRemainingEl.textContent = remaining > 0 ? 'Remaining: ' + remaining : 'Completed ‚Äî Withdrawals Unlocked';
        if(adsWatched >= REQUIRED_ADS){
          adsProgressEl.classList.add('pulse');
          notify('Ads requirement completed ‚Äî Withdraw enabled!');
          withdrawDoBtn.classList.add('celebrate');
          setTimeout(()=> adsProgressEl.classList.remove('pulse'), 2500);
        } else {
          adsProgressEl.classList.remove('pulse');
          withdrawDoBtn.classList.remove('celebrate');
        }
        // reset group progress display if not in an active group
        if (!currentGroupActive) {
          groupProgressEl.textContent = 'Group: 0/' + GROUP_SIZE;
        }
      }

      // small helper to animate a highlight on balance
      function flashBalance(){
        balanceEl.animate([
          { boxShadow: '0 10px 30px rgba(2,8,18,.45)' },
          { boxShadow: '0 10px 40px rgba(0,209,167,.18)' },
          { boxShadow: '0 10px 30px rgba(2,8,18,.45)' }
        ], { duration: 700 });
      }

      // ====== Rewarded Ad via libtl (now requires GROUP_SIZE sequential ads per increment) ======
      let currentGroupCount = 0;
      let currentGroupActive = false;

      function setGroupProgress(n){
        currentGroupCount = n;
        groupProgressEl.textContent = 'Group: ' + currentGroupCount + '/' + GROUP_SIZE;
      }

      async function playRewardedAd(){
        if (adsWatched >= REQUIRED_ADS) { notify('Ads requirement already completed'); return; }
        if (currentGroupActive) { notify('Already loading ads...'); return; }
        currentGroupActive = true;
        watchAdBtn.disabled = true;
        const originalText = watchAdBtn.textContent;
        setGroupProgress(0);
        try{
          for (let i = 1; i <= GROUP_SIZE; i++){
            // update UI
            watchAdBtn.textContent = 'Ad ' + i + '/' + GROUP_SIZE + ' ‚Äî Loading...';
            setGroupProgress(i-1);
            // attempt to show one rewarded ad; if it fails, throw to abort the group
            await show_10245709();
            // after a successful ad
            setGroupProgress(i);
            // small pulse feedback
            adsProgressEl.classList.add('pulse');
            setTimeout(()=> adsProgressEl.classList.remove('pulse'), 300);
            // brief micro-notify for each ad completion (subtle)
            // (no notify to avoid spamming; we keep visual updates)
          }
          // all GROUP_SIZE ads watched successfully
          adsWatched = Math.min(adsWatched + 1, REQUIRED_ADS);
          saveAds();
          updateAdUI();
          notify(GROUP_SIZE + ' ads completed ‚Äî Progress +1 (' + adsWatched + '/' + REQUIRED_ADS + ')');
          // visual celebration
          adsProgressEl.classList.add('pulse');
          setTimeout(()=> adsProgressEl.classList.remove('pulse'), 900);
        }catch(e){
          // If any ad fails or user cancels, do not increment; reset group progress
          notify('Ad not completed, please try again.');
        }finally{
          currentGroupActive = false;
          watchAdBtn.disabled = false;
          watchAdBtn.textContent = originalText;
          setGroupProgress(0);
        }
      }
      watchAdBtn.addEventListener('click', playRewardedAd);

      const format = v => (Number.isFinite(v) ? v.toFixed(4) : '0.0000');
      function saveUSDT(){ localStorage.setItem('usdt', usdt.toFixed(4)); }

      function notify(msg){
        notifyEl.textContent = msg;
        notifyEl.classList.add('show');
        notifyEl.setAttribute('aria-hidden','false');
        setTimeout(()=> {
          notifyEl.classList.remove('show');
          notifyEl.setAttribute('aria-hidden','true');
        }, 2500);
      }

      function init(){
        gameActive=true; timeLeft=30;
        timerEl = document.getElementById('timer');
        usdtHud = document.getElementById('usdtHud');
        overlay = document.getElementById('overlay');
        usdtText = document.getElementById('usdtText');
        usdtHud.textContent = format(usdt);
        overlay.classList.remove('show');
        document.querySelectorAll('.drop').forEach(d=>d.remove());
        clearInterval(countDown);
        countDown = setInterval(()=>{
          timeLeft--;
          timerEl.textContent = timeLeft;
          if(timeLeft<=0){ clearInterval(countDown); endGame(); }
        },1000);
        clearInterval(spawnInterval);
        spawnInterval = setInterval(()=>{
          if(!gameActive){ clearInterval(spawnInterval); return; }
          spawn();
        },220);
      }

      function endGame(){
        gameActive=false;
        usdtText.textContent = format(usdt);
        overlay.classList.add('show');
        clearInterval(spawnInterval);
        saveUSDT();
      }

      async function spawn(){
        if(!gameActive) return;
        const d = document.createElement('img');
        d.className = 'drop';
        d.setAttribute('alt','collectible');
        d.setAttribute('role','button');
        d.tabIndex = 0;
        try{
          const res = await fetch(imgURL);
          const blob = await res.blob();
          d.src = URL.createObjectURL(blob);
        }catch{
          d.src = imgURL;
        }
        d.style.left = Math.random()*100 + '%';
        d.style.animationDuration = (Math.random()*0.4 + 1.4) + 's';
        d.addEventListener('click', function boom(e){
          if(!gameActive) return;
          usdt += 0.005;
          usdt = Math.floor(usdt * 10000) / 10000;
          usdtHud.textContent = format(usdt);
          saveUSDT();
          const emoji = document.createElement('div');
          emoji.className = 'pop-emoji';
          emoji.textContent = emojis[Math.floor(Math.random()*emojis.length)];
          emoji.style.left = (e.clientX - 16) + 'px';
          emoji.style.top = (e.clientY - 16) + 'px';
          document.body.appendChild(emoji);
          setTimeout(()=>emoji.remove(),400);
          timerEl.animate([{ transform: 'translateY(0)' }, { transform: 'translateY(-6px)' }, { transform: 'translateY(0)' }], { duration: 260 });
          try {
            const s = new Audio('data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA=');
            s.volume = 0.04; s.play().catch(()=>{});
          } catch {}
          this.remove();
        });
        d.addEventListener('keydown', function(e){
          if(!gameActive) return;
          if(e.key === 'Enter' || e.key === ' '){
            e.preventDefault();
            this.click();
          }
        });
        document.body.appendChild(d);
        d.addEventListener('animationend', ()=>d.remove());
      }

      function openWithdraw(){
        overlay.classList.remove('show');
        usdt = parseFloat(localStorage.getItem('usdt')||'0') || 0;
        balanceEl.textContent = format(usdt);
        usdtHud.textContent = format(usdt);
        addrEl.value = '';
        amtEl.value = '';
        updateAdUI(); // ÿ™ÿ≠ÿØŸäÿ´ Ÿàÿßÿ¨Ÿáÿ© ÿßŸÑÿ•ÿπŸÑÿßŸÜÿßÿ™
        withdrawPanel.classList.add('show');
        withdrawPanel.setAttribute('aria-hidden','false');
        setTimeout(()=> addrEl.focus(),120);
      }

      function closeWithdraw(){
        withdrawPanel.classList.remove('show');
        withdrawPanel.setAttribute('aria-hidden','true');
        if(!gameActive) overlay.classList.add('show');
        setTimeout(()=> document.getElementById('withdrawBtnOverlay').focus(),120);
      }

      function validateAddress(a){
        if(!a) return false;
        a = a.trim();
        const re0x = /^0x[a-fA-F0-9]{40}$/;
        const rebnb = /^bnb[0-9a-z]{38,}$/i;
        return re0x.test(a) || rebnb.test(a);
      }

      withdrawDoBtn.addEventListener('click', ()=>{
        if(usdt < MIN_WITHDRAW){ notify('Insufficient balance'); return; }
        if(adsWatched < REQUIRED_ADS){ notify('Please complete 1000 ads first'); return; }
        const addr = addrEl.value.trim();
        if(!validateAddress(addr)){ notify('Invalid BNB address'); addrEl.focus(); return; }
        let amt = parseFloat(amtEl.value || '0') || 0;
        if(Number.isNaN(amt) || amt <= 0){ notify('Enter valid amount'); amtEl.focus(); return; }
        amt = Math.floor(amt * 10000)/10000;
        if(amt < MIN_WITHDRAW){ notify('Minimum withdrawal 2 USDT'); amtEl.focus(); return; }
        if(amt > usdt + 0.0000001){ notify('Amount exceeds balance'); amtEl.focus(); return; }

        const withdrawals = JSON.parse(localStorage.getItem('withdrawals')||'[]');
        withdrawals.push({id:'wd_'+Date.now(), address:addr, amount:amt.toFixed(4), timestamp:new Date().toISOString(), status:'pending'});
        localStorage.setItem('withdrawals', JSON.stringify(withdrawals));
        usdt = Math.max(0, Math.floor((usdt - amt) * 10000)/10000);
        saveUSDT();
        usdtHud.textContent = format(usdt);
        balanceEl.textContent = format(usdt);
        flashBalance();
        notify('Withdrawal saved locally');
      });

      // Helper buttons functionality
      useMaxBtn.addEventListener('click', function(){
        amtEl.value = usdt.toFixed(4);
        amtEl.focus();
      });
      add2Btn.addEventListener('click', function(){
        let cur = parseFloat(amtEl.value || '0') || 0;
        cur = Math.floor((cur + 2) * 10000)/10000;
        amtEl.value = cur.toFixed(4);
        amtEl.focus();
      });
      add5Btn.addEventListener('click', function(){
        let cur = parseFloat(amtEl.value || '0') || 0;
        cur = Math.floor((cur + 5) * 10000)/10000;
        amtEl.value = cur.toFixed(4);
        amtEl.focus();
      });

      document.getElementById('restartBtn').addEventListener('click', ()=>{ clearInterval(countDown); clearInterval(spawnInterval); init(); });
      document.getElementById('withdrawBtnOverlay').addEventListener('click', ()=> openWithdraw());
      backToGameBtn.addEventListener('click', closeWithdraw);
      document.addEventListener('keydown', e=>{ if(e.key==='Escape' && withdrawPanel.classList.contains('show')) closeWithdraw(); });
      document.body.addEventListener('pointerdown', ()=>{ const a=new Audio('data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYWN0BAAAAG90aGVy'); a.volume=.08; a.play().catch(()=>{}); });
      document.addEventListener('DOMContentLoaded', ()=>{ init(); updateAdUI(); });

      // Ensure withdraw button disabled state is accurate on load
      updateAdUI();

      // Accessibility: announce stored withdrawals count on open
      document.getElementById('withdrawBtnOverlay').addEventListener('focus', ()=>{
        const withdrawals = JSON.parse(localStorage.getItem('withdrawals')||'[]');
        if(withdrawals.length) notify('You have ' + withdrawals.length + ' saved withdrawal(s).');
      });

      // Small enhancement: long-press hold to open withdraw panel from HUD score (mobile friendly)
      let holdTimer;
      const scoreWrap = document.getElementById('scoreWrap');
      scoreWrap.addEventListener('pointerdown', (e)=>{
        holdTimer = setTimeout(()=> {
          openWithdraw();
        }, 650);
      });
      scoreWrap.addEventListener('pointerup', ()=> clearTimeout(holdTimer));
      scoreWrap.addEventListener('pointercancel', ()=> clearTimeout(holdTimer));
      scoreWrap.addEventListener('pointermove', ()=> clearTimeout(holdTimer));

      // Prevent accidental navigation on small devices when interacting
      window.addEventListener('touchmove', function(e){
        if (document.activeElement && (document.activeElement.tagName === 'INPUT')) {
          e.stopPropagation();
        }
      }, {passive:true});

    })();
  </script>
</body>
</html>